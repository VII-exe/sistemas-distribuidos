# Sistema de Mensagens Distribu√≠das

## Descri√ß√£o

Sistema distribu√≠do de publica√ß√£o e leitura de mensagens entre m√∫ltiplos n√≥s, implementando consist√™ncia eventual e autentica√ß√£o b√°sica. Desenvolvido para a disciplina de Sistemas Distribu√≠dos do IFBA - Campus Santo Ant√¥nio de Jesus.

## Arquitetura

- **3 n√≥s distribu√≠dos** (Node1, Node2, Node3)
- **Comunica√ß√£o TCP** entre n√≥s (portas 8001, 8002, 8003)
- **Interface Web HTTP** (portas 9001, 9002, 9003)
- **Cliente terminal** para intera√ß√£o avan√ßada
- **Replica√ß√£o ass√≠ncrona** de mensagens
- **Consist√™ncia eventual** com sincroniza√ß√£o autom√°tica

## Pr√©-requisitos

- Python 3.8+
- Sistema operacional: Windows
- Portas 8001-8003 para login e 9001-9003 para interface web dispon√≠veis

## Estrutura do Projeto

```bash
sistema-distribuido-de-mensageria/
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îú‚îÄ‚îÄ client.py              # Cliente terminal interativo
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                # Sistema de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ message.py             # Estrutura das mensagens
‚îÇ   ‚îú‚îÄ‚îÄ node.py                # L√≥gica principal dos n√≥s
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ index.html             # Interface web
‚îÇ   ‚îú‚îÄ‚îÄ app.js                 # JavaScript do frontend
‚îÇ   ‚îî‚îÄ‚îÄ styles.css             # Estilos CSS
‚îú‚îÄ‚îÄ logs/                      # Logs do sistema (criado automaticamente)
‚îú‚îÄ‚îÄ nodes/
‚îÇ   ‚îú‚îÄ‚îÄ node1/run.py          # Executor do Node1
‚îÇ   ‚îú‚îÄ‚îÄ node2/run.py          # Executor do Node2
‚îÇ   ‚îî‚îÄ‚îÄ node3/run.py          # Executor do Node3
‚îú‚îÄ‚îÄ iniciar_programa.py        # Script principal de inicializa√ß√£o
‚îî‚îÄ‚îÄ README.md                # Este arquivo
```

## Como Executar

### M√©todo 1: Execu√ß√£o Autom√°tica (Recomendado)

1. **Clone o reposit√≥rio:**

```bash
git clone <URL_DO_REPOSITORIO>
cd sistema-distribuido-de-mensageria
```

2. **Execute o script principal:**

```bash
python iniciar_programa.py
```

3. **O sistema ir√°:**
   - Iniciar os 3 n√≥s automaticamente
   - Abrir o cliente terminal em nova janela
   - Disponibilizar interfaces web em:
     - <http://localhost:9001> (Node1)
     - <http://localhost:9002> (Node2)
     - <http://localhost:9003> (Node3)

### M√©todo 2: Execu√ß√£o Manual

1. **Terminal 1 - Node1:**

```bash
python nodes/node1/run.py
```

2. **Terminal 2 - Node2:**

```bash
python nodes/node2/run.py
```

3. **Terminal 3 - Node3:**

```bash
python nodes/node3/run.py
```

4. **Terminal 4 - Cliente:**

```bash
python client/client.py
```

## üë§ Usu√°rios Dispon√≠veis

| Usu√°rio | Senha | Descri√ß√£o |
|---------|-------|-----------|
| admin | admin123 | Administrador |
| user1 | password1 | Usu√°rio 1 |
| user2 | password2 | Usu√°rio 2 |
| test | test | Usu√°rio de teste |

## üéÆ Como Usar

### Interface Terminal

1. **Login em um n√≥:**

```python
login admin admin123 8001
```

2. **Enviar mensagem p√∫blica:**

```python
post Ol√°, pessoal!
```

3. **Enviar mensagem privada:**

```python
postpv Mensagem confidencial
```

4. **Ler mensagens:**

```python
read                    # Ler mensagens do n√≥ atual
read 8002              # Ler mensagens do Node2
readpub 8003           # Ler apenas mensagens p√∫blicas do Node3
```

5. **Gerenciar m√∫ltiplos usu√°rios:**

```python
login user1 password1 8002    # Login em outro n√≥
switch                        # Alternar entre usu√°rios
```

6. **Simular falhas:**

```pyhon
simulate                # Simular falha do n√≥ atual
simulate                # Reconectar (recupera mensagens perdidas)
```

7. **Comandos √∫teis:**

```python
status                  # Ver status de todos os n√≥s
help                    # Ver todos os comandos
quit                    # Sair
```

### Interface Web

1. **Acesse qualquer interface:**
   - <http://localhost:9001>
   - <http://localhost:9002>
   - <http://localhost:9003>

2. **Fa√ßa login ou visualize mensagens p√∫blicas**

3. **Envie mensagens p√∫blicas ou privadas**

4. **Simule falhas atrav√©s do bot√£o "Simular Falha"**

## Cen√°rios de Teste

### Teste 1: Replica√ß√£o B√°sica

1. Login user1 no Node1 e user2 no Node2
2. user1 envia: "Mensagem p√∫blica"
3. Verificar se aparece no chat do user2

### Teste 2: Mensagens Privadas

1. Login em dois n√≥s diferentes
2. Enviar mensagem privada
3. Verificar visibilidade apenas para usu√°rios logados

### Teste 3: Simula√ß√£o de Falha

1. Login em Node1 e Node2
2. Simular falha no Node2
3. Enviar mensagens do Node1
4. Reconectar Node2 e verificar sincroniza√ß√£o

### Teste 4: Consist√™ncia Eventual

1. Simular falha em 2 n√≥s
2. Deixar 1 n√≥ ativo e enviar v√°rias mensagens
3. Reconectar n√≥s offline
4. Verificar se todas as mensagens foram sincronizadas

### Teste 5: Login Duplicado

1. Tentar fazer login com mesmo usu√°rio em m√∫ltiplos n√≥s
2. Sistema deve impedir login duplicado

## Logs e Monitoramento

### Logs do Sistema

Os logs s√£o salvos automaticamente em:

- `logs/Node1.log` - Logs do Node1
- `logs/Node2.log` - Logs do Node2  
- `logs/Node3.log` - Logs do Node3

### Informa√ß√µes nos Logs

- Tentativas de login
- Envio e recebimento de mensagens
- Opera√ß√µes de sincroniza√ß√£o
- Simula√ß√µes de falha
- Reconex√µes e recupera√ß√£o

## Solu√ß√£o de Problemas

### Erro "Porta em uso"

```bash
# Verificar processos usando as portas
netstat -an | grep :8001
netstat -an | grep :9001

# Matar processos se necess√°rio (Windows)
taskkill /f /pid <PID>
```

### Cliente n√£o conecta

1. Verificar se os n√≥s est√£o rodando
2. Verificar se as portas est√£o dispon√≠veis
3. Tentar reiniciar o sistema

### Interface web n√£o carrega

1. Verificar se a pasta `frontend/` existe
2. Verificar permiss√µes de arquivo
3. Tentar acessar diretamente: <http://localhost:9001>

### Problemas de sincroniza√ß√£o

1. Verificar logs em `logs/`
2. Reiniciar todos os n√≥s
3. Testar com apenas 2 n√≥s primeiro

## Tecnologias Utilizadas

- **Python 3.8+** - Linguagem principal
- **Socket TCP** - Comunica√ß√£o entre n√≥s
- **HTTP Server** - Interface web
- **Bootstrap 5** - Frontend responsivo
- **JSON** - Serializa√ß√£o de dados
- **MD5** - Hash de senhas (para simplicidade)
- **Threading** - Concorr√™ncia

## Funcionalidades Implementadas

### Requisitos Obrigat√≥rios

- [x] M√≠nimo 3 n√≥s distribu√≠dos
- [x] C√≥pia local do mural em cada n√≥
- [x] Comunica√ß√£o via sockets TCP
- [x] Replica√ß√£o ass√≠ncrona
- [x] Consist√™ncia eventual
- [x] Autentica√ß√£o b√°sica
- [x] Leitura p√∫blica sem autentica√ß√£o
- [x] Simula√ß√£o de falhas
- [x] Reconcilia√ß√£o ap√≥s reconex√£o

### Funcionalidades Extras

- [x] Interface web responsiva
- [x] Cliente terminal avan√ßado
- [x] M√∫ltiplos usu√°rios simult√¢neos
- [x] Mensagens p√∫blicas e privadas
- [x] Logs detalhados para auditoria
- [x] Sistema de status em tempo real
- [x] Preven√ß√£o de login duplicado

## Autores

- **Aluno:** Vinicius X. e Kleberson J.
- **Disciplina:** Sistemas Distribu√≠dos
- **Professor:** Felipe Silva
- **Institui√ß√£o:** IFBA - Campus Santo Ant√¥nio de Jesus
- **Curso:** Superior de Tecnologia em An√°lise e Desenvolvimento de Sistemas - 5¬∫ Semestre
